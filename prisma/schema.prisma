generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // url removed: Prisma v7+ uses prisma.config.ts for datasource config
}

model Person {
  id           String   @id @default(uuid())
  slug         String   @unique
  displayName  String
  avatarUrl    String?
  bio          String?
  isStaff      Boolean  @default(false)
  canComment   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  shifts              Shift[]
  recommendationsFrom Recommendation[] @relation("fromPerson")
  recommendationsTo   Recommendation[] @relation("toPerson")
  instagramPosts      InstagramPost[]
  favorites           Favorite[]      @relation("favoritePerson")
  user                User?           @relation(fields: [userId], references: [id])
  userId              String?         @unique
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  createdAt DateTime  @default(now())
  favorites Favorite[]
  person    Person?
}

model Shop {
  id         String   @id @default(uuid())
  slug       String   @unique
  displayName String
  area       String?
  address    String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  shifts     Shift[]
}

model Shift {
  id        String   @id @default(uuid())
  person    Person   @relation(fields: [personId], references: [id])
  personId  String
  shop      Shop     @relation(fields: [shopId], references: [id])
  shopId    String
  date      DateTime
  startTime DateTime?
  endTime   DateTime?
  note      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([personId, shopId, date])
  @@index([date])
  @@index([personId, date])
}

model Recommendation {
  id          String   @id @default(uuid())
  fromPerson  Person   @relation("fromPerson", fields: [fromPersonId], references: [id])
  fromPersonId String
  toPerson    Person   @relation("toPerson", fields: [toPersonId], references: [id])
  toPersonId   String
  isApproved   Boolean @default(true)
  body         String
  createdAt    DateTime @default(now())

  @@unique([fromPersonId, toPersonId])
  @@index([toPersonId])
  @@index([fromPersonId])
}

model Favorite {
  id          String   @id @default(uuid())
  user        User     @relation(fields: [userId], references: [id])
  userId      String
  person      Person   @relation("favoritePerson", fields: [personId], references: [id])
  personId    String
  createdAt   DateTime @default(now())

  @@unique([userId, personId])
}

model InstagramPost {
  id          String   @id @default(uuid())
  person      Person   @relation(fields: [personId], references: [id])
  personId    String
  url         String
  imageUrl    String?
  postedAt    DateTime?
  createdAt   DateTime @default(now())
}
